---
title: "服务管理"
---

一个 Kubernetes 的服务 (Service) 是一种抽象，它定义了一类 Pod 的逻辑集合和一个用于访问它们的策略 - 有的时候被称之为微服务，而在这个集合中的 Pod 的 IP 地址以及数量等都会发生动态变化，这个服务的客户端并不需要知道这些变化，也不需要自己来记录这个集合的 Pod 信息，这一切都是由抽象层 Service 来完成。

## 创建服务

首先登录 KubeSphere 控制台，在左侧导航栏选择 **网络与服务** 菜单的 **服务** 进入到服务列表页面。左上角为当前所在项目，点击下拉框可以切换到其他的项目。选择不同的项目，就可以看到对应项目下的所有服务。如果是管理员登录，可以看到集群所有项目的服务情况，如果是普通用户，则只能查看授权项目下的所有服务。列表顶部显示了当前项目的服务配额和 VIP、Headless 数量信息。右上角的条形图显示近一周内服务数量的一个变化统计。


创建服务支持三种方式，**页面创建**，**导入 yaml 文件**，**编辑模式**创建。以下主要介绍页面创建的方式。若选择以编辑模式，可点击右上角编辑模式进入代码界面，支持 yaml 和 json 格式。左上角显示配置文件列表和导入导出按钮。其中导入 yaml 文件方式会自动将 yaml 文件内容填充到页面上，用户根据需要可以在页面上调整后再行创建。编辑模式可以方便习惯命令行操作的用户直接在页面上编辑 yaml 文件创建服务。

![服务列表](/services-list.png)

1. 填写服务的名称，注意不能和现有项目下的其它服务名称相同。

2. 选择需要创建服务的类型，每种服务类型适合不同的场景:

> - VirtualIP: 以集群为服务生成的集群内唯一的 IP 为基础，集群内部可以通过此 IP 来访问服务，集群外部可以通过 NodePort 和 LoadBalancer 方式来访问服务。此类型适合绝大多数服务。
> - Headless (selector): 集群不为服务生成 IP，集群内部通过服务的后端 Pod IP 直接访问服务。此类型适合后端异构的服务，比如需要区分主从的服务。
> - Headless (externalname): 将集群或者项目外部服务映射到集群或项目内。

3. 您可以使用选择器来选择不同的后端，使用键值对 (Label Selector) 可以选择多个部署。填写完成服务的端口号和对应的后端端口号

![创建服务](/services-create.png)

4. 为即将创建的服务添加标签，让 KubeSphere 更好的管理资源。

5. 为服务选择外网访问方式。LoadBalancer 的方式需要对应的负载均衡器插件来启用，如果未安装插件则无法使用，也可以在服务创建完成后修改外网访问方式。

> - None: 只在集群内部访问服务，集群外部无法访问。
> - NodePort: 集群外部可以通过访问集群节点的对应端口来访问服务，端口将由集群自动创建。
> - LoadBalancer: 通过云服务商提供的负载均衡器来访问服务。

![外网访问服务](/services-public-access.png)

6. 创建完成后即可在服务列表中查看到已创建的服务。 

## 查看服务详情

在服务列表里点击服务即可进入服务详情页面。左侧显示服务的基本信息，右侧包含服务的资源状态、事件和操作日志。资源状态页列出了服务的具体信息，包括端口信息、微服务策略（AB 测试）、服务后端的工作负载和容器组。 点击 **更多操作** 也可以对服务进行修改编辑操作。

![服务详情](/services-detail.png)

> 说明：在集群中访问服务时，同一项目下可以直接使用服务的 DNS 名称来访问。如上图，在项目 kubepshere-system 下可以直接使用 ks-console:80 来访问服务; 在其它项目下，需要加上项目后缀，使用 ks-console.kubesphere-system:80 来访问服务。

### 修改外网访问方式

点击左侧 "**...**" 按钮来编辑服务外网访问方式。

> 注：修改外网访问方式可能导致其它依赖此服务的应用不可用，请谨慎操作。

![修改服务](/services-edit.png)