---
title: "应用路由管理"
---

应用路由是来聚合集群内服务的方式，对应的是 Kubernetes 的 Ingress 资源，后端使用了 Nginx Controller 来处理具体规则。Ingress 可以给 service 提供集群外部访问的 URL、负载均衡、SSL termination、HTTP 路由等。

本节通过以下几个方面介绍如何管理应用路由：

- 如何管理应用路由
  - 启用外网访问入口
  - 创建应用路由
  - 访问应用路由

# 如何管理应用路由

登录 KubeSphere 控制台，在左侧导航栏选择 **服务与网络** 菜单的 **应用路由** 进入到应用路由列表页面。

![](/router-gateway1.png)

## 启用外网访问入口

在创建应用路由之前，需要先启用外网访问入口，即网关。这一步是创建对应的应用路由控制器，来负责将请求转发到对应的后端服务。如不预先启用外网访问入口，创建的应用路由规则将无法访问。

1.点击应用路由规则列表上方的 **外网访问入口** 按钮

2.在弹出的窗口左侧选择需要启用的项目，在右侧选择网关的类型。

- NodePort: 此方式网关可以通过工作节点对应的端口来访问
- LoadBalancer: 此方式网关可以通过统一的一个外网IP来访问。(此方式需要对应的负载均衡器插件)


3.选择对应的网关启用方式后，点击 **应用** 来创建网关。如下图选择的是 NodePort 的方式。

![](/router-gateway.png)

4.外网入口启用完成后，我们即可创建应用路由。

## 创建应用路由

> 应用路由需要先启用外网访问入口，请按照上面步骤启用外网访问入口

1.点击应用路由规则右上角的 **创建应用路由** 按钮，填写应用路由的名称

2.填写应用路由的规则，如图所示。

- Host: 应用规则的访问域名，最终使用此域名来访问对应的服务。(如果访问入口是以 NodePort 的方式启用，需要保证Host能够在客户端正确解析到集群工作节点上；如果是以LoadBalancer方式启用，需要保证Host正确解析到负载均衡器的IP上)

- Path: 应用规则的路径和对应的后端服务，端口需要填写成服务的端口

![](/router-create.png)

3.点击下一步，为应用规则添加注解。如无特殊设置，这一步可以跳过。

4.添加标签后，创建完成。

## 访问应用路由

应用路由创建完成后，确保设置的域名可以解析到外网访问入口的IP地址，即可使用域名访问。如在私有环境中，可以使用修改本地 hosts 文件的方式来使用应用路由。例如，

|设置的域名|路径|外网访问入口方式|端口/IP|集群工作节点IP|
----|---|---|---|---
|demo.kubesphere.io|/|NodePort|32586,31920|192.168.0.4,192.168.0.3,192.168.0.2|
|demo2.kubesphere.io|/|LoadBalancer|139.198.1.1|192.168.0.4,192.168.0.3,192.168.0.2

如上表格，创建了两条应用路由规则，分别使用 NodePort 和 LoadBalancer 方式的访问入口。在私有环境下，我们可以直接在主机的 hosts 文件中添加记录来使域名解析到对应的 IP。例如，对于 `demo.kubesphere.io` ，我们添加如下记录

```
demo.kubesphere.io 192.168.0.4
```

需要保证客户端与集群工作节点 192.168.0.4 网络可通，可以使用其它工作节点的IP，只要客户端和工作节点网络是通的，设置完之后，在浏览器中使用域名和网关的端口号(此示例中是32586) `http://demo.kubesphere.io:32586` 即可访问。

对于 `demo2.kubesphere.io`，添加

```
demo2.kubesphere.io 139.198.1.1
```

设置完成之后，使用 `http://demo2.kubesphere.io` 即可访问。

> 以上是私有环境的示例，如果 DNS 中已存在域名到对应IP的记录，则可以跳过上述步骤，直接使用应用规则中设置的域名来访问。